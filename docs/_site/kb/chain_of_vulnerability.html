<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>202 ecommerce Security Advisories | Knowledge Base and CVE about PrestaShop modules security issues</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="202 ecommerce Security Advisories" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Knowledge Base and CVE about PrestaShop modules security issues" />
<meta property="og:description" content="Knowledge Base and CVE about PrestaShop modules security issues" />
<link rel="canonical" href="http://localhost:4000/kb/chain_of_vulnerability.html" />
<meta property="og:url" content="http://localhost:4000/kb/chain_of_vulnerability.html" />
<meta property="og:site_name" content="202 ecommerce Security Advisories" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="202 ecommerce Security Advisories" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Knowledge Base and CVE about PrestaShop modules security issues","headline":"202 ecommerce Security Advisories","url":"http://localhost:4000/kb/chain_of_vulnerability.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=4bc3c89cac8fbad3ba971bc19bb35e9f7b5409b1">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      
      <h1 class="project-name">
      
        <a href="/security-advisories/index.html" style="color:#e9edee">
          <!-- <img src="" style="width:0%; height:0%"> -->
          202 ecommerce Security Advisories
        </a>
      </h1>

      <h2 class="project-tagline">
        Knowledge Base and CVE about PrestaShop modules security issues
      </h2>

      
        <a href="index.html" class="btn">Index</a>
      

      
        <a href="https://github.com/cbourgeois202/security-advisories" class="btn">View on GitHub</a>
      

      

      
        
          <a href="../index.html" class="btn">Home page</a>
        
      

    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="prevent-chain-of-vulnerability">Prevent chain of vulnerability</h1>

<ol>
  <li><a href="#none-obvious-trusted-data">None obvious trusted data</a></li>
  <li><a href="#sample-with-file_put_contents">Sample with file_put_contents</a></li>
</ol>

<h2 id="none-obvious-trusted-data">None obvious trusted data</h2>

<blockquote>
  <p><strong><em>DO:</em></strong></p>
  <pre><code class="language-PHP">&lt;?php
function test() {
   $id = Configuration::get('MY_CONF');
   $name = Context::getContext()-&gt;cookie-&gt;mymodule_name;
   $querystr = 'SELECT id, `' . bqSQL($name) . '` FROM mytable WHERE id = ' . (int) $id;
   return Db::getInstance()-&gt;executeS($querystr);
}
</code></pre>
</blockquote>

<p>Be careful with parameters that come from databases like <em>PrestaShop Configurations</em> ! It can contain an SQL injection… In which case ? If you have another sql injection, this type of vulnerability is more hidden and perhaps easier to exploit.
Data from Cookie like in the previous sample with sensitive SQL calls can be dangerous.</p>

<p>Take the habits to fix all sensitive SQL calls !</p>

<h2 id="sample-with-file_put_contents">Sample with file_put_contents</h2>

<p>In this sample, this piece of code calls a webservice that should return a barcode image. In a PrestaShop configuration, the administrator has selected a type of file (PNG, JPG or PDF).</p>

<blockquote>
  <p><strong><em>DON’T DO:</em></strong></p>
  <pre><code class="language-PHP">$type = Configuration::get('MY_TYPE_OF_FILE'); // pdf or jpeg or png
$api = new ClientAPI(Configuration::get('MY_API_URL'));

$content = $api-&gt;getBarcode($product-&gt;ean);

file_put_contents(dirname(__FILE__) . 'files/' . $product-&gt;ean . '.' . $type, $content);
</code></pre>
</blockquote>

<p>Be aware that code is very sensitive ! In fact, in case of SQL injection or a sensitive controller that saves Configuration without enough verifications, URL of the API and type of file can be hijacked by malicious data. In fine, a hacker can inject a malicious PHP file like a webshell or a filemanager.</p>

<blockquote>
  <p><strong><em>DO:</em></strong></p>
  <pre><code class="language-PHP">$type = Configuration::get('MY_TYPE_OF_FILE'); // pdf or jpeg or png
if (in_array($type, ['png', 'jpeg', 'png']) === false) {
   exit;
}
$api = new ClientAPI(Configuration::get('MY_API_URL'));

$content = $api-&gt;getBarcode($product-&gt;ean);

file_put_contents(dirname(__FILE__) . 'files/' . $product-&gt;ean . '.' . $type, $content);
</code></pre>
</blockquote>

<p><br /></p>

<hr />

<p><br /></p>

<table>
  <tbody>
    <tr>
      <td><a href="/security-advisories/kb/logical_weakness.html"><img src="/kb/images/left-arrow-9133251.png" alt="go left" /></a></td>
      <td><a href="/kb/logical_weakness.html">Prevent logical weakness</a></td>
      <td><a href="/security-advisories/kb/index.html"><img src="/kb/images/back-to-menu-arrow-9121722.png" alt="go back" /></a></td>
      <td><a href="#prevent-chain-of-vulnerability"><img src="/kb/images/up-arrow-1767592-1502496.png" alt="go up" /></a></td>
    </tr>
  </tbody>
</table>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/cbourgeois202/security-advisories">security-advisories</a> is maintained by <a href="https://github.com/cbourgeois202">cbourgeois202</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
